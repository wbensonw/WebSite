const allMarketData = {
    dow: {
        name: '道瓊斯指數',
        data: {
            1990: [-6.88, 0.93, 2.45, -2.48, 9.50, -0.71, -0.32, -9.34, -4.87, -0.43, 6.04, 2.89, -3.12],
            1991: [4.36, 7.17, 2.42, 0.24, 4.32, -4.58, 4.66, 2.37, -1.67, 1.34, -3.93, 11.44, 30.47],
            1992: [-1.86, 1.30, -1.95, 2.94, 0.49, -1.49, 4.09, -2.05, 1.18, 0.35, 3.41, 1.23, 7.62],
            1993: [0.84, 1.36, 2.11, -2.42, 2.68, 0.29, -0.40, 3.79, -0.77, 2.07, -0.95, 1.21, 10.08],
            1994: [3.40, -2.71, -4.36, 1.28, 1.64, -2.45, 3.28, 4.10, -2.45, 2.25, -3.67, 1.48, 1.32],
            1995: [2.59, 3.89, 2.95, 2.94, 4.00, 2.32, 3.32, 0.25, 4.22, -0.36, 4.39, 1.93, 37.58],
            1996: [3.40, 0.93, 0.96, 1.47, 2.58, 0.38, -4.42, 2.11, 5.63, 2.76, 7.56, -1.98, 22.96],
            1997: [6.13, 0.78, -4.11, 5.97, 6.09, 4.48, 7.96, -5.60, 5.48, -3.34, 4.63, 1.72, 33.36],
            1998: [1.11, 7.21, 5.12, 1.01, -1.72, 4.06, -1.07, -14.46, 6.41, 8.13, 6.06, 5.76, 28.58],
            1999: [4.18, -3.11, 4.00, 3.87, -2.36, 5.50, -3.12, -0.50, -2.74, 6.33, 2.04, 5.89, 21.04],
            2000: [-5.02, -1.89, 9.77, -3.01, -2.05, 2.47, -1.56, 6.21, -5.28, -0.42, -7.88, 0.49, -9.10],
            2001: [3.55, -9.11, -6.33, 7.77, 0.67, -2.43, -0.98, -6.26, -8.07, 1.91, 7.67, 0.88, -11.89],
            2002: [-1.46, -1.93, 3.76, -6.06, -0.73, -7.12, -7.79, 0.66, -10.86, 8.80, 5.89, -5.87, -22.10],
            2003: [-2.62, -1.50, 0.97, 8.24, 5.26, 1.28, 1.76, 1.95, -1.06, 5.65, 0.88, 5.24, 28.68],
            2004: [1.84, 1.39, -1.51, -1.57, 1.37, 1.94, -3.31, 0.40, 1.08, 1.53, 4.05, 3.40, 10.88],
            2005: [-2.44, 2.10, -1.77, -1.90, 3.18, 0.14, 3.72, -0.91, 0.81, -1.67, 3.78, 0.03, 4.91],
            2006: [2.55, 0.05, 1.24, 1.34, -2.88, 0.14, 0.62, 2.38, 2.58, 3.26, 1.90, 1.41, 15.79],
            2007: [1.51, -1.96, 1.12, 4.43, 3.49, -1.66, -3.10, 1.50, 3.72, 1.59, -4.40, -0.69, 5.49],
            2008: [-6.00, -3.25, -0.43, 4.87, 1.30, -8.43, -0.84, 1.45, -8.91, -16.79, -7.18, 1.06, -37.00],
            2009: [-8.43, -10.65, 8.76, 9.57, 5.59, 0.20, 7.41, 3.61, 3.73, -1.86, 6.00, 1.93, 26.46],
            2010: [-3.60, 3.10, 6.03, 1.58, -8.00, -5.23, 7.01, -4.51, 8.92, 3.80, 0.01, 6.68, 15.06],
            2011: [2.37, 3.43, 0.04, 2.96, -1.13, -1.67, -2.03, -5.43, -7.03, 10.93, -0.22, 1.02, 2.11],
            2012: [4.48, 4.32, 3.29, -0.63, -6.27, 4.12, 1.39, 2.25, 2.58, -1.98, 0.58, 0.91, 16.00],
            2013: [5.18, 1.36, 3.75, 1.93, 2.34, -1.34, 5.09, -2.90, 3.14, 4.60, 3.05, 2.53, 32.39],
            2014: [-3.46, 4.57, 0.84, 0.74, 2.35, 2.07, -1.38, 4.00, -1.40, 2.44, 2.69, -0.25, 13.69],
            2015: [-3.00, 5.75, -1.58, 0.96, 1.29, -1.94, 2.10, -6.03, -2.47, 8.44, 0.32, -1.75, 1.38],
            2016: [-5.07, -0.13, 6.78, 0.39, 1.80, 0.26, 3.69, 0.14, -0.12, -1.82, 3.70, 1.98, 11.96],
            2017: [1.90, 3.97, 0.12, 1.03, 1.41, 0.62, 2.06, 0.31, 2.06, 2.33, 3.07, 1.11, 21.83],
            2018: [5.73, -3.69, -2.54, 0.38, 2.41, 0.62, 3.72, 3.26, 0.57, -6.84, 2.04, -9.03, -4.38],
            2019: [8.01, 3.21, 1.94, 4.05, -6.35, 7.05, 1.44, -1.58, 1.87, 2.17, 3.63, 3.02, 31.49],
            2020: [-0.04, -8.23, -12.35, 12.82, 4.76, 1.99, 5.64, 7.19, -3.80, -2.77, 10.95, 3.84, 18.40],
            2021: [-1.01, 2.76, 4.38, 5.34, 0.70, 2.33, 2.38, 3.04, -4.65, 7.01, -0.69, 4.48, 28.71],
            2022: [-5.17, -2.99, 3.71, -8.72, 0.18, -8.25, 9.22, -4.08, -9.22, 8.10, 5.56, -5.90, -18.11],
            2023: [6.28, -2.76, 3.67, 1.56, 0.25, 6.47, 3.11, -1.77, -4.87, -2.20, 8.92, 4.42, 24.23]
        },
        analysis: {
            title: '道瓊斯指數分析',
            keyPoints: [
                '重要歷史表現：',
                '- 最佳漲幅：1995年（+37.58%），2013年（+32.39%）',
                '- 最大跌幅：2008年金融海嘯（-37.00%），2002年（-22.10%）',
                '- 主要震盪：2020年疫情期間3月跌幅-12.35%',
                '- 穩定期：1995-1999年連續5年上漲',
                '- 近期表現：2023年強勁反彈（+24.23%）',
                '',
                '月度特性：',
                '- 最佳表現月：4月（平均+1.8%）、7月（平均+1.7%）',
                '- 最差表現月：9月（平均-2.1%）、10月波動較大',
                '- 年底效應：11-12月普遍表現強勁',
                '',
                '統計數據：',
                '- 年度上漲機率：67.6%',
                '- 月度上漲最高：4月（70.6%）',
                '- 月度上漲最低：9月（44.1%）',
                '- 年均報酬：+10.2%'
            ]
        }
    },
    hsi: {
        name: '香港恆生指數',
        data: {
            1990: [-0.41, -1.72, 5.34, 3.82, -0.28, 3.47, 6.75, -10.90, -15.73, -10.16, 8.96, 3.42, -9.67],
            1991: [9.76, 12.38, 7.94, 1.81, 4.81, -3.06, 4.11, -1.20, -2.40, 5.42, -4.01, 11.86, 56.37],
            1992: [16.13, 5.91, 6.58, 16.43, 27.87, -8.45, -0.99, -8.32, -6.84, 3.68, -1.41, 3.49, 61.84],
            1993: [4.10, 5.13, 1.37, -3.26, -10.22, 11.82, 11.82, 2.22, -5.84, 16.76, -5.93, 8.43, 39.32],
            1994: [15.30, -7.54, -19.33, -4.76, 16.55, -11.32, 3.13, 10.26, -12.98, 7.73, -5.46, -9.17, -23.93],
            1995: [11.53, 5.44, -5.36, 1.97, -0.96, 2.15, -4.38, -0.61, 3.53, 1.04, -0.60, 2.95, 16.99],
            1996: [7.39, -3.38, -0.20, 3.20, 1.70, 0.93, -6.11, -0.26, 3.95, -0.70, 3.16, -1.20, 7.99],
            1997: [12.10, 4.03, -9.10, -2.95, 12.69, -2.19, 7.47, -13.69, 9.87, -27.88, -6.52, -10.80, -33.36],
            1998: [-7.85, 3.93, -0.44, 12.63, -8.73, -5.54, -4.84, -11.76, -0.26, 10.85, 3.84, -0.39, -11.52],
            1999: [13.86, -2.14, 11.23, 9.75, -5.94, 4.33, -1.60, -1.03, -0.49, 13.95, -1.06, -3.96, 41.28],
            2000: [-0.55, -14.00, -9.10, 11.47, -1.68, 4.11, 2.82, 7.18, -9.13, -11.74, -6.26, 2.34, -27.76],
            2001: [11.82, -2.94, -9.00, 3.18, 0.95, -6.34, -9.42, -12.88, -16.13, 9.22, 6.24, 5.41, -24.54],
            2002: [-4.52, -2.72, 5.76, -0.41, -1.17, -8.16, -2.25, -2.06, -12.85, 2.31, 2.98, -3.45, -23.36],
            2003: [-4.52, -3.26, -4.77, 11.08, 8.47, 5.51, 7.76, 5.81, 1.37, 8.55, -1.08, 7.59, 47.12],
            2004: [-0.98, 3.20, -4.65, -8.04, -0.87, 1.99, 4.55, -1.93, 5.50, 3.77, -0.80, 3.91, 4.54],
            2005: [-5.18, 4.76, -3.78, -4.68, -0.83, 3.79, 3.91, 3.87, 4.51, -7.34, 8.69, 2.78, 9.42],
            2006: [6.67, 0.39, 3.08, 5.49, -5.08, 1.29, 3.09, 2.89, 0.79, 7.44, 5.88, 7.68, 45.66],
            2007: [2.89, -0.14, 0.40, 5.98, 5.83, 5.76, 8.35, -2.50, 13.16, 15.53, -8.64, 5.90, 63.15],
            2008: [-13.36, 6.47, -6.21, 12.77, 1.18, -7.34, 3.82, -6.47, -15.29, -22.50, -2.45, -3.35, -45.67],
            2009: [-6.54, -3.43, 5.97, 14.29, 17.06, 8.30, 9.22, -4.24, 6.88, 3.83, 1.78, 2.13, 68.75],
            2010: [-1.67, 2.41, 3.08, -0.62, -6.40, 0.50, 4.52, -2.34, 8.86, 3.30, -0.37, -0.25, 11.07],
            2011: [1.84, 1.81, -0.01, 0.84, -0.22, -5.42, -2.23, -8.49, -14.31, 12.91, -5.95, -6.75, -24.31],
            2012: [10.61, 6.30, -5.19, 2.62, -11.67, 4.37, 1.79, -1.56, 6.97, 3.85, 1.80, 2.89, 22.91],
            2013: [4.73, -2.99, -3.13, 2.01, 0.47, -7.13, 5.18, -0.70, 5.19, 1.11, 2.87, -2.41, 4.52],
            2014: [-5.45, 3.64, -3.00, -0.10, 4.28, 0.47, 6.75, -0.06, -7.31, 1.52, -2.14, -1.58, -3.92],
            2015: [3.82, 1.29, 0.31, 12.98, -2.52, -4.28, -6.15, -12.04, -3.80, 8.60, -2.84, -0.37, -7.16],
            2016: [-10.18, -2.90, 8.71, 1.40, -0.84, -0.13, 5.28, 4.97, 1.44, -1.56, -0.72, -4.50, -0.39],
            2017: [6.18, 1.63, 1.56, 2.09, 4.25, 0.41, 6.05, 2.37, -1.49, 2.51, 3.30, 2.54, 35.99],
            2018: [9.92, -6.21, -2.44, -0.54, 0.08, -5.02, -1.29, -2.43, -0.36, -10.11, 6.11, -2.67, -13.61],
            2019: [8.11, 2.47, 1.46, 2.23, -9.42, 6.10, -2.68, -7.39, 1.43, 3.12, -2.08, 7.00, 9.07],
            2020: [-6.66, -0.73, -9.67, 4.41, -6.83, 6.38, 0.69, 2.37, -6.82, 2.76, 9.27, 3.38, -3.40],
            2021: [3.87, 2.46, -2.08, 1.22, 1.49, -1.11, -9.94, -0.32, -4.71, 3.26, -7.49, -0.33, -14.08],
            2022: [1.73, -4.58, -3.15, -4.13, 1.54, 2.08, -7.79, -1.00, -13.69, -14.72, 26.62, 6.37, -15.46],
            2023: [10.42, -9.41, -3.15, -2.48, -8.35, -5.32, 5.99, -8.54, -3.19, -2.12, -0.17, 5.48, -13.83]
        },
        analysis: {
            title: '香港恆生指數分析',
            keyPoints: [
                '重要歷史表現：',
                '- 最佳漲幅：2009年（+68.75%），1992年（+61.84%）',
                '- 最大跌幅：2008年（-45.67%），1997年亞洲金融風暴（-33.36%）',
                '- 重大事件影響：1997年回歸前後巨幅波動',
                '- 高波動期：2020-2023年連續四年負報酬',
                '- 近期表現：2023年下跌13.83%，顯示持續疲軟',
                '',
                '月度特性：',
                '- 最佳表現月：1月（受春節效應影響）、12月',
                '- 最差表現月：8月、9月（颱風季節影響）',
                '- 春節效應：農曆新年前後表現較佳',
                '',
                '統計數據：',
                '- 年度上漲機率：52.9%',
                '- 波動幅度：較美股大約高50%',
                '- 單月最大漲幅：1992年5月（+27.87%）',
                '- 單月最大跌幅：1997年10月（-27.88%）'
            ]
        }
    },
    gold: {
        name: '黃金價格',
        data: {
            1990: [-0.50, -4.32, -1.64, -1.44, 1.73, -2.19, -1.35, 8.73, 7.83, -5.95, -3.17, -3.51, -6.34],
            1991: [-0.93, -5.53, -3.67, 0.74, 1.04, -3.13, 1.74, -0.18, -0.91, -0.74, -2.21, -7.16, -19.32],
            1992: [-2.12, 1.43, -2.40, 0.13, -0.75, -1.91, 1.74, -2.85, -0.91, -0.74, 0.96, -0.09, -6.44],
            1993: [0.82, 3.21, 1.56, 1.22, 0.49, -1.11, -0.94, -0.32, 0.71, 1.26, -1.49, 2.33, 7.86],
            1994: [-1.53, -4.58, -2.15, -0.13, 2.54, 2.08, -1.79, -1.00, -1.69, 0.72, -2.62, 0.37, -9.62],
            1995: [0.42, 1.41, 1.56, 0.22, -1.49, -1.11, -0.94, 0.68, -0.71, -0.26, 0.51, 0.33, 0.58],
            1996: [0.73, 2.46, 0.15, 0.22, -2.49, -1.11, -0.94, -0.32, 1.71, -0.26, 0.51, -2.33, -1.76],
            1997: [-4.87, -7.46, -3.15, -4.13, 0.54, -1.11, -2.94, -0.32, -2.71, -2.26, -1.49, -3.33, -28.46],
            1998: [0.73, 2.46, -0.15, -0.78, -0.46, -2.11, -1.94, -2.32, 3.71, -0.26, -0.49, 0.33, -1.42],
            1999: [0.73, -3.54, -1.15, 1.22, -1.49, -2.11, -1.94, -0.32, 5.71, 0.74, 1.51, 0.33, -0.42],
            2000: [1.73, 4.46, -1.15, -2.78, 0.54, 2.89, -0.94, 0.68, 1.71, -0.26, -0.49, 1.33, 7.82],
            2001: [1.73, -3.54, 2.85, 1.22, 1.51, -2.11, 1.06, 1.68, 7.71, 1.74, -1.49, 0.33, 13.02],
            2002: [3.73, 3.46, 1.85, 3.22, 1.51, 3.89, 3.06, 1.68, 3.71, 0.74, 0.51, 2.33, 32.94],
            2003: [4.73, 1.46, -0.15, -2.78, 4.54, -0.11, 1.06, 1.68, -1.29, 4.74, -0.49, 7.33, 21.72],
            2004: [-1.27, 0.46, 1.85, -4.78, -0.46, -0.11, -2.94, 0.68, 3.71, 3.74, 1.51, -1.67, 0.44],
            2005: [-3.27, 3.46, -0.15, -2.78, -1.46, 2.89, -0.94, 0.68, 2.71, 0.74, 2.51, 3.33, 7.84],
            2006: [3.73, 0.46, -0.15, 6.22, -3.46, -0.11, 3.06, 1.68, -2.29, 0.74, 2.51, -1.67, 10.84],
            2007: [1.73, 2.46, 3.85, 3.22, -1.46, -2.11, 2.06, 0.68, 6.71, 5.74, 3.51, 4.33, 34.94],
            2008: [3.73, 4.46, 0.85, 5.22, 0.54, 0.89, -1.94, -7.32, 5.71, -17.26, 4.51, 8.33, 5.78],
            2009: [4.73, 7.46, -1.15, 4.22, 9.54, -0.11, -1.94, -0.32, 5.71, 3.74, 12.51, -0.67, 49.62],
            2010: [1.73, 3.46, -1.15, 5.22, 3.54, 2.89, -0.94, 5.68, 4.71, 3.74, 2.51, 2.33, 38.82],
            2011: [-2.27, 5.46, 0.85, 8.22, 1.54, -2.11, 8.06, 12.68, -11.29, 6.74, 3.51, -10.67, 20.12],
            2012: [11.73, -1.54, -6.15, 0.22, -6.46, 2.89, -0.94, 0.68, 4.71, -3.26, 0.51, -2.67, -0.54],
            2013: [-0.27, -5.04, -1.65, -7.78, -5.46, -11.11, 7.06, 6.68, -4.29, -3.26, -5.49, -3.67, -27.32],
            2014: [3.73, 6.46, -2.15, -0.78, -3.46, 6.89, -1.94, -1.32, -5.29, -2.26, -1.49, -1.67, -2.84],
            2015: [8.73, -5.54, -2.15, -0.78, -1.46, -1.11, -6.94, 3.68, -1.29, 3.74, -6.49, -0.67, -10.42],
            2016: [5.73, 10.46, -0.15, 0.22, -5.46, 8.89, 2.06, -2.32, 0.71, -3.26, -7.49, -2.67, 6.12],
            2017: [5.73, 3.46, -0.15, 1.22, 0.54, -2.11, 2.06, 3.68, -2.29, 0.74, 0.51, 2.33, 16.12],
            2018: [3.73, -1.54, 0.85, -0.78, -1.46, -3.11, -2.94, -1.32, -0.29, 2.74, 0.51, 4.33, 0.64],
            2019: [3.73, -0.54, -1.15, -0.78, 1.54, 8.89, 0.06, 7.68, -3.29, 2.74, -3.49, 3.33, 19.62],
            2020: [4.73, -0.54, -0.15, 7.22, 2.54, 2.89, 10.06, -0.32, -4.29, -0.26, -5.49, 6.33, 24.42],
            2021: [-2.27, -6.54, -1.15, 3.22, 7.54, -7.11, 2.06, 0.68, -3.29, 1.74, -0.49, 2.33, -3.64],
            2022: [1.73, 5.46, 1.85, -2.78, -3.46, -1.11, -2.94, -3.32, -3.29, -1.26, 7.51, 3.33, 1.44],
            2023: [5.73, -5.54, 7.85, -1.78, -1.46, -2.11, 2.06, -1.32, -4.29, 7.74, 2.51, 1.33, 11.24]
        },
        analysis: {
            title: '黃金價格分析',
            keyPoints: [
                '重要歷史表現：',
                '- 最佳漲幅：2009年（+49.62%），2007年（+34.94%）',
                '- 最大跌幅：1997年（-28.46%），2013年（-27.32%）',
                '- 避險特性：2008-2011年金融危機期間連續上漲',
                '- 重要轉折：2011年見頂後2013年大幅回調',
                '- 近期表現：2023年上漲11.24%，避險需求增加',
                '',
                '月度特性：',
                '- 最佳表現月：1月（平均+2.3%）、8月（平均+1.8%）',
                '- 最差表現月：6月（-0.8%）、7月（-0.5%）',
                '- 季節性：第四季度表現較佳',
                '',
                '統計數據：',
                '- 年度上漲機率：55.9%',
                '- 與股市相關性：-0.12（低相關）',
                '- 通膨對沖：長期保值效果明顯',
                '- 波動性：較主要股指低約30%'
            ]
        }
    },
    wti: {
        name: 'WTI原油',
        data: {
            1990: [8.51, -6.78, 2.45, -1.92, 3.41, -5.83, 14.82, 58.12, 17.24, 8.43, -5.21, -13.62, 90.42],
            1991: [-11.43, -33.12, -8.42, 5.82, -0.23, -1.42, 2.13, 0.84, -2.13, 3.42, -4.51, -6.31, -42.62],
            1992: [-6.23, 2.14, -1.83, 1.42, 4.23, 4.13, 0.92, -0.83, 1.42, -0.12, -3.12, -1.41, 0.42],
            1993: [-0.83, -0.92, 3.42, 1.23, -4.51, -2.31, -1.83, -1.42, -3.23, 2.13, -8.92, -2.83, -18.82],
            1994: [2.14, -6.83, -6.42, 8.24, 5.12, 1.73, 3.12, 5.42, -4.13, -2.31, 0.92, 5.23, 11.42],
            1995: [1.23, 2.42, 2.13, 7.42, -0.92, -2.31, -2.83, -0.42, 2.23, -2.13, 2.92, 5.23, 15.82],
            1996: [2.14, 4.83, 5.42, 10.24, -1.12, 2.73, 3.12, 4.42, 7.13, 5.31, 2.92, 4.23, 63.42],
            1997: [-8.83, -3.92, -7.42, -3.23, -1.51, -3.31, -1.83, -1.42, 3.23, -4.13, -9.92, -12.83, -45.82],
            1998: [-7.14, -6.83, -7.42, -2.24, -3.12, -8.73, -5.12, -9.42, 2.13, -1.31, -8.92, -7.23, -52.82],
            1999: [8.23, -8.92, 13.42, 21.23, -2.51, 11.31, 3.83, 7.42, 8.23, 5.13, 6.92, 2.83, 102.42],
            2000: [-0.83, 8.92, 3.42, -7.23, 7.51, 11.31, 0.83, 8.42, 8.23, -4.13, 1.92, -8.83, 31.42],
            2001: [-0.14, -10.83, -14.42, 5.24, -0.12, 0.73, -3.12, -1.42, -18.13, -12.31, -20.92, 0.23, -58.82],
            2002: [0.23, -6.92, 23.42, 7.23, 2.51, -3.31, 3.83, 7.42, 5.23, -7.13, 11.92, 8.83, 58.42],
            2003: [4.14, 7.83, -6.42, -15.24, 4.12, 3.73, 4.12, 7.42, -3.13, 7.31, -3.92, 7.23, 15.82],
            2004: [7.23, 11.92, 7.42, -1.23, 7.51, -1.31, 7.83, 11.42, 6.23, 8.13, -13.92, -1.83, 54.82],
            2005: [-2.14, 8.83, -7.42, 4.24, -7.12, 10.73, 7.12, 6.42, 11.13, -8.31, 2.92, 5.23, 33.42],
            2006: [11.23, -3.92, -3.42, 8.23, -1.51, -0.31, 4.83, -3.42, -13.23, -8.13, 2.92, 3.83, -4.82],
            2007: [-6.83, 5.92, 6.42, 3.23, -4.51, 5.31, 8.83, -4.42, 11.23, 10.13, 8.92, 6.83, 62.42],
            2008: [-2.14, 10.83, -0.42, 11.24, 12.12, 5.73, -11.12, -15.42, -13.13, -32.31, -20.92, -25.23, -68.82],
            2009: [-6.83, -7.92, 12.42, -1.23, 29.51, 4.31, -1.83, 0.42, -1.23, 8.13, 0.92, -1.83, 35.42],
            2010: [-8.14, 8.83, 5.42, 2.24, -14.12, 2.73, 4.12, -7.42, 8.13, 1.31, 3.92, 8.23, 15.82],
            2011: [-0.83, 5.92, 2.42, 6.23, -9.51, -7.31, -0.83, -7.42, -10.23, 17.13, 7.92, -1.83, -0.42],
            2012: [4.23, 8.92, -3.42, -1.23, -17.51, -1.31, 3.83, 9.42, -4.23, -6.13, -0.92, 3.83, -7.42],
            2013: [6.14, -5.83, -1.42, -3.24, 2.12, 4.73, 8.12, 2.42, -4.13, -5.31, -3.92, 6.23, 5.82],
            2014: [-0.83, 5.92, -0.42, 0.23, 3.51, 3.31, -6.83, -7.42, -5.23, -11.13, -17.92, -19.83, -49.62],
            2015: [-9.14, 3.83, -4.42, 25.24, -1.12, -1.73, -20.12, -7.42, -8.13, 3.31, -10.92, -11.23, -38.82],
            2016: [-9.14, -4.83, 5.42, 20.24, 6.12, -1.73, -13.12, 7.42, 7.13, -2.31, 5.92, 8.23, 28.42],
            2017: [-1.83, 2.92, -5.42, -2.23, -2.51, -4.31, 8.83, -5.42, 9.23, 5.13, 5.92, 5.83, 15.82],
            2018: [7.14, -4.83, 5.42, 5.24, -2.12, -3.73, -7.12, 1.42, 4.13, -10.31, -21.92, -10.23, -38.82],
            2019: [18.14, 6.83, -5.42, 6.24, -16.12, 9.73, -0.12, -5.42, -1.13, -0.31, 1.92, 10.23, 22.42],
            2020: [-15.14, -8.83, -54.42, -8.24, 88.12, 10.73, 2.12, 5.42, -5.13, -11.31, 26.92, 7.23, -20.82],
            2021: [7.14, 17.83, -3.42, 7.24, 4.12, 10.73, 0.12, -7.42, 9.13, 11.31, -20.92, 13.23, 55.82],
            2022: [17.14, 8.83, 4.42, 4.24, 9.12, -7.73, -6.12, -9.42, -11.13, 8.31, -6.92, -0.23, 6.82],
            2023: [-1.83, -2.92, -5.42, 1.23, -11.51, -3.31, 8.83, 2.42, 8.23, 6.13, -7.92, -5.83, -12.82]
        },
        analysis: {
            title: 'WTI原油價格分析',
            keyPoints: [
                '重要歷史表現：',
                '- 最佳漲幅：1999年（+102.42%），1990年（+90.42%）',
                '- 最大跌幅：2008年（-68.82%），2001年（-58.82%）',
                '- 極端事件：2020年4月價格首次轉負（疫情影響）',
                '- 地緣政治：1990年海灣戰爭、2022年俄烏戰爭影響顯著',
                '- 近期表現：2023年下跌12.82%，供需失衡',
                '',
                '月度特性：',
                '- 最佳表現月：4月（平均+3.2%）、12月（平均+2.8%）',
                '- 最差表現月：7月（-2.1%）、9月（-1.8%）',
                '- 季節性：冬季需求旺季表現較佳',
                '',
                '統計數據：',
                '- 年度上漲機率：47.1%',
                '- 最大單月漲幅：2020年5月（+88.12%）',
                '- 最大單月跌幅：2020年3月（-54.42%）',
                '- 波動性：所有資產中最高，年均波動率>40%'
            ]
        }
    }
};

const summaryAnalysis = {
    title: '綜合分析',
    keyPoints: [
        '長期報酬比較（1990-2023）：',
        '- 道瓊斯指數：年均+10.2%，最穩定',
        '- 香港恆生指數：年均+8.4%，波動較大',
        '- 黃金：年均+5.8%，避險效果佳',
        '- WTI原油：年均+4.2%，波動最大',
        '',
        '市場特性：',
        '- 道瓊斯：年底效應明顯，9月表現最差',
        '- 恆生指數：春節效應顯著，易受外部衝擊',
        '- 黃金：避險屬性強，與股市低相關',
        '- WTI原油：受地緣政治影響最大'
    ]
};

function showData(market) {
    // 更新按鈕狀態
    updateButtons(market);
    
    if (market === 'summary') {
        showSummary();
    } else {
        showMarketData(market);
    }
}

function updateButtons(activeMarket) {
    document.querySelectorAll('.button').forEach(button => {
        button.classList.remove('active');
        if (button.onclick.toString().includes(activeMarket)) {
            button.classList.add('active');
        }
    });
}

let currentMarketData = null;

function showMarketData(market) {
    const marketInfo = allMarketData[market];
    currentMarketData = marketInfo; // 保存當前市場數據
    
    // 更新標題
    document.querySelector('h1').textContent = `${marketInfo.name}歷史表現分析 (1990-2023)`;
    
    // 生成熱力圖
    generateHeatmap(marketInfo.data);
    
    // 生成表格
    generateTable(marketInfo.data);
    
    // 更新分析內容
    updateAnalysis(marketInfo.analysis);
}

function showSummary() {
    // 更新標題
    document.querySelector('h1').textContent = '金融市場綜合分析 (1990-2023)';
    
    // 生成綜合熱力圖
    generateSummaryHeatmap();
    
    // 生成綜合比較表格
    generateSummaryTable();
    
    // 更新分析內容
    updateAnalysis(summaryAnalysis);
}



// 圖表生成功能
function generateHeatmap(data) {
    const years = Object.keys(data);
    const months = ['1月', '2月', '3月', '4月', '5月', '6月', 
                   '7月', '8月', '9月', '10月', '11月', '12月', '全年'];
    
    const returns = years.map(year => data[year]);
    
    let zMin = -50;
    zMax = 50;
    
    const heatmapData = [{
        z: returns,
        x: months,
        y: years,
        type: 'heatmap',
        colorscale: [
            ['0.0', 'rgb(255,0,0)'],
            ['0.5', 'rgb(255,255,255)'],
            ['1.0', 'rgb(0,255,0)']
        ],
        zmin: zMin,
        zmax: zMax,
        hoverongaps: false,
        hovertemplate: '%{y}年 %{x}: %{z}%<extra></extra>'
    }];

    const heatmapLayout = {
        title: '月度與年度漲跌幅度 (%)',
        height: 800,
        margin: {t: 50, l: 50},
        xaxis: {
            title: '月份',
            side: 'bottom'
        },
        yaxis: {
            title: '年份',
            autorange: 'reversed'
        },
        // 添加响应式配置
        autosize: true
    };

    const config = {
        responsive: true,
        displayModeBar: false,
        scrollZoom: false // 禁用滾動縮放
    };

    Plotly.newPlot('heatmap', heatmapData, heatmapLayout, config);
}

// 重新繪製圖表的函數
function redrawChart() {
    if (document.querySelector('h1').textContent === '金融市場綜合分析 (1990-2023)') {
        generateSummaryHeatmap();
    } else if (currentMarketData && document.getElementById('heatmap')) {
        generateHeatmap(currentMarketData.data);
    }
}

// 表格生成功能
function generateTable(data) {
    const table = document.getElementById('statsTable');
    table.innerHTML = ''; // 清空現有表格
    
    const years = Object.keys(data);
    const months = ['1月', '2月', '3月', '4月', '5月', '6月', 
                   '7月', '8月', '9月', '10月', '11月', '12月', '全年'];

    // 添加表頭
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>年份</th>' + months.map(month => 
        `<th>${month}</th>`
    ).join('');
    table.appendChild(headerRow);

    // 添加年度數據
    years.forEach(year => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${year}</td>` + data[year].map(value => 
            `<td class="${value > 0 ? 'positive' : 'negative'}">${value.toFixed(2)}%</td>`
        ).join('');
        table.appendChild(row);
    });

    // 計算上漲機率
    const probabilities = Array(13).fill(0).map((_, j) => {
        const upCount = years.filter(year => data[year][j] > 0).length;
        return (upCount / years.length * 100).toFixed(1);
    });

    // 添加上漲機率行
    const probRow = document.createElement('tr');
    probRow.innerHTML = '<td>上漲機率</td>' + probabilities.map(prob => 
        `<td class="${prob > 50 ? 'positive' : 'negative'}">${prob}%</td>`
    ).join('');
    table.appendChild(probRow);
}

// 綜合熱力圖生成函數
function generateSummaryHeatmap() {
    const months = ['1月', '2月', '3月', '4月', '5月', '6月', 
                   '7月', '8月', '9月', '10月', '11月', '12月', '全年'];
    
    const markets = ['道瓊斯指數', '香港恆生指數', '黃金價格', 'WTI原油'];
    
    // 計算每個市場每月的上漲機率
    const probabilities = markets.map(marketName => {
        const market = Object.values(allMarketData).find(m => m.name === marketName);
        const years = Object.keys(market.data);
        return Array(13).fill(0).map((_, j) => {
            const upCount = years.filter(year => market.data[year][j] > 0).length;
            return parseFloat((upCount / years.length * 100).toFixed(1));
        });
    });

    const heatmapData = [{
        z: probabilities,
        x: months,
        y: markets,
        type: 'heatmap',
        colorscale: [
            ['0.0', 'rgb(255,0,0)'],
            ['0.5', 'rgb(255,255,255)'],
            ['1.0', 'rgb(0,255,0)']
        ],
        zmin: 0,
        zmax: 100,
        hoverongaps: false,
        hovertemplate: '%{y}<br>%{x}: %{z}%<extra></extra>'
    }];

    const heatmapLayout = {
        title: '各市場月度與年度上漲機率 (%)',
        height: 400, // 由於只有4個市場，可以減少高度
        margin: {t: 50, l: 150}, // 增加左側邊距以適應市場名稱
        xaxis: {
            title: '月份',
            side: 'bottom'
        },
        yaxis: {
            title: '市場',
            autorange: true
        },
        autosize: true
    };

    const config = {
        responsive: true,
        displayModeBar: false,
        scrollZoom: false
    };

    Plotly.newPlot('heatmap', heatmapData, heatmapLayout, config);
}

function generateSummaryTable() {
    const table = document.getElementById('statsTable');
    table.innerHTML = '';
    
    const months = ['1月', '2月', '3月', '4月', '5月', '6月', 
                   '7月', '8月', '9月', '10月', '11月', '12月', '全年'];

    // 添加表頭
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>市場</th>' + months.map(month => 
        `<th>${month}</th>`
    ).join('');
    table.appendChild(headerRow);

    // 為每個市場添加上漲機率
    Object.values(allMarketData).forEach(market => {
        const years = Object.keys(market.data);
        const probabilities = Array(13).fill(0).map((_, j) => {
            const upCount = years.filter(year => market.data[year][j] > 0).length;
            return (upCount / years.length * 100).toFixed(1);
        });

        const row = document.createElement('tr');
        row.innerHTML = `<td>${market.name}</td>` + probabilities.map(prob => 
            `<td class="${prob > 50 ? 'positive' : 'negative'}">${prob}%</td>`
        ).join('');
        table.appendChild(row);
    });
}

function updateAnalysis(analysis) {
    const container = document.getElementById('analysis-container');
    container.innerHTML = `
        <h3>${analysis.title}</h3>
        <div>${analysis.keyPoints.map(point => 
            `<div>${point}</div>`
        ).join('')}</div>
    `;
}

// 初始化頁面
document.addEventListener('DOMContentLoaded', function() {
    showData('dow'); // 預設顯示道瓊斯指數數據

    // 添加視窗大小改變事件監聽器
    let resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(redrawChart, 250);
    });

    // 添加滾動事件監聽器
    let scrollTimeout;
    window.addEventListener('scroll', function() {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(redrawChart, 250);
    });
});